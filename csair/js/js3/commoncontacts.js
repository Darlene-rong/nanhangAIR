$(() => {
  window.contactTravel = {
    tabData: [{
      sequence: 1,
      contactName: '12weq', //联系人名字
      cpId: 'sdasd', //联系人唯一id
      email: 'sfas', //邮箱
      fpCardNo: 'asda', //明珠卡号	
      mobilePhone: 'wqewq', //手机号码	
      userId: 'qweqw', //用户id
      userIdType: 'asda', //
    }, {
      sequence: 2,
      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      sequence: 3,

      contactName: '气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      sequence: 4,

      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      sequence: 5,

      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      sequence: 6,

      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      sequence: 7,

      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      sequence: 8,

      contactName: 'dsd气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      sequence: 9,

      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      sequence: 10,

      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      sequence: 11,

      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      sequence: 12,

      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      sequence: 13,

      contactName: 'weqwe气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      contactName: '三气', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, {
      contactName: 'qqq', //联系人名字
      cpId: '三气', //联系人唯一id
      email: '三气', //邮箱
      fpCardNo: '三气', //明珠卡号	
      mobilePhone: '三气', //手机号码	
      userId: '三气', //用户id
      userIdType: '三气', //
    }, ],
    pyId: '',
    init() {
      //验证是否登录
      if (this.windowInit()) {
        this.tabInit();
        this.eventInit();
      } else {
        console.log('dd')
      }
    },
    windowInit() {
      //判断是否在线
      if (!window.userName) {
        // window._yyPlayAlert('登录超时，请重新登录！');
        return false;
      } else {
        return true;
      }
    },
    tabInit() {
      // window.loading.show();
      this.tabData.total = this.tabData.length;
      this.cc_pageInit(this.tabData, 1)
    },
    eventInit() {
      var $this = this;
      //返回
      $(".js_contact_back").on('click', function () {
        if ($this.windowInit()) {
          $(".js_contact_table").show();
          $(".js_contact_dailog").hide();
          $("#commonForm")[0].reset();
          $this.pyId = '';
        }
      });
      // 保存
      $(".js_contact_save").on('click', function () {
        $this.commonToSave();
      });
      //check
      window.bindCheckKeyDown(".js_common_check");
      //查询
      $(".js_contect_search").on('click', function () {
        console.log($("#searname"))
      })
    },
    contactEdit(type, val) {
      //编辑
      //window.loading.show()
      //ajax
      var $this = this;
      if ($this.windowInit()) {
        $(".js_contact_table").hide();
        $(".js_contact_dailog").show();
        if (type == 'add') {
          //新增
        } else {
          //修改
          let json = {
            contactName: "二蛋",
            mobilePhone: "155225485",
            fpCardNo: "222",
            email: "111@..."
          };
          $('#contactName').val(json.contactName);
          $('#mobilePhone').val(json.mobilePhone);
          $('#fpCardNo').val(json.fpCardNo);
          $('#email').val(json.email);
          $this.pyId = val;
        }

      } else {
        //返回主页
      }
    },
    contactDel(contactName, mobilePhone, email, cpId) {
      //删除
      console.log(contactName, mobilePhone, email, cpId);
      var $this = this;
      var delJson = {
        contactName: contactName,
        mobilePhone: mobilePhone,
        email: email,
        cpId: cpId,
      };
      // 删除ajax  /deleteContact
      $this.tabInit();
    },
    commonToSave() {
      if (this.commonFormValite()) {
        console.log('ee');
        console.log(this.pyId);
        //提交表单的ajax 
      }
    },
    commonBlur(type) {
      //失焦检测
      var dom = '#' + type;
      var $this = this;
      var json = {
        contactName: '联系人姓名',
        mobilePhone: '联系人手机号',
        email: '邮箱号',
      };
      let tip = '';
      if (type != 'fpCardNo') {
        if ($(dom).val() == '') {
          tip = json[type] + '必填';
          $this.tipPlay('.js_common_tip', 'dom', tip);
          return;
        } else {
          $(".js_common_tip").html();
        };
      }
      if (type == 'mobilePhone') {
        if (window.checkMobile($(dom).val()) == false) {
          $this.tipPlay('.js_common_tip', '', '手机号码输入有误，请重新输入！');
          return true;
        }
      } else if (type == 'fpCardNo') {
        if (window.yzMzNumber($("#fpCardNo").val()) == false) {
          $this.tipPlay('.js_common_tip', '',  '明珠卡号输入格式有误，请重新输入');
        }
      } else if (type == 'email') {
        if (!window.isEmail($("#email").val().trim())) {
          $this.tipPlay('.js_common_tip', '',  'E-mail格式输入有误');
        }
      }
    },
    commonFormValite(type) {
      var $this = this;
      var mark = false;
      if ($("#contactName").val() == '') {
        $this.tipPlay('.js_common_tip', '#contactName', '联系人姓名不能为空');
        return mark;
      };
      if ($("#mobilePhone").val() == '') {
        $this.tipPlay('.js_common_tip', '#mobilePhone', '手机号不能为空');
        return mark;
      } else {
        if (window.checkMobile($("#mobilePhone").val()) == false) {
          $this.tipPlay('.js_common_tip', '#mobilePhone', '手机号码输入有误，请重新输入！');
          return mark;
        }
      };
      if ($("#fpCardNo").val() != '') {
        if (window.yzMzNumber($("#fpCardNo").val()) == false) {
          $this.tipPlay('.js_common_tip', '#fpCardNo', '明珠卡号输入格式有误，请重新输入');
          return mark;
        }
      };
      if ($("#email").val() == '') {
        $this.tipPlay('.js_common_tip', '#email', 'E-mail不能为空');
        return mark;
      } else {
        if (!window.isEmail($("#email").val().trim())) {
          $this.tipPlay('.js_common_tip', '#email', 'E-mail格式输入有误');
          return mark;
        }
      };
      if (!$("#check").is(':checked')) {
        $this.tipPlay('.js_common_tip', '#check', '请阅读隐私通知并且勾选');
        return mark;
      };
      return true;
    },
    tipPlay(dom, focusdom, title) {
      $(dom).text(title);
      if (focusdom) {
        $(focusdom).focus()
      }
      // window.playerText(title);
    },
    cc_pageInit(arr, pageNum) {
      console.log(arr, 'pageinit')
      let pageSize = 10;
      var $this = this;
      $this.cc_pageContent(0, pageSize)
      $("#js_common_Page").tzPage(arr.total, {
        num_display_entries: 8, //主体页数
        num_edge_entries: 2, //边缘页数
        current_page: pageNum - 1, //指明选中页码
        items_per_page: pageSize, //每页显示多条条
        prev_text: "上一页",
        next_text: "下一页",
        showGo: false, //显示跳转
        showSelect: false,
        prev_show_always: true,
        next_show_always: true,
        callback: function (pageno) { //会回传两个参数一个当前页，显示的页数
          $this.cc_pageContent(pageno, pageSize)
        }
      });
    },
    cc_pageContent(pageNo, pageSize) {
      var $this = this;
      var tabHTML = '';
      var startIndex = pageNo * pageSize;
      var endIndex = pageSize * (pageNo + 1);
      var newArr = this.tabData.slice(startIndex, endIndex);
      $.each(newArr, function (index, val) {
        tabHTML += `
          <tr>
            <td>${this.sequence}</td>
            <td>${this.contactName}</td>
            <td>${this.mobilePhone}</td>
            <td>${this.email}</td>
            <td>${this.fpCardNo}</td>
            <td>
              <a href="javascript:;" class="btn pc-btn-detail" data-orderno="${this.cpId}" onclick="contactTravel.contactEdit('edit','${this.cpId}')">修改</a>
              <a href="javascript:;" class="btn pc-btn-detail" data-orderno="${this.cpId}" onclick="contactTravel.contactDel('${this.contactName}','${this.mobilePhone}','${this.email}','${this.cpId}')">删除</a>
            </td>
          </tr>
        `
      });
      $(".js_common_tab").html(tabHTML);
    },
  };
  contactTravel.init();
})